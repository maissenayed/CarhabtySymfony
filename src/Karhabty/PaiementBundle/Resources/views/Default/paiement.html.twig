{% extends 'layout/LayoutUser.html.twig' %}
{% block content %}



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
    <script src="{{ asset('assets/js/jquery.payment.js') }}"></script>
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>
    <style type="text/css" media="screen">
        .has-error input {
            border-width: 2px;
        }
        .validation.text-danger:after {
            content: 'Validation failed';
        }
        .validation.text-success:after {
            content: 'Validation passed';
        }
    </style>

    <script>


/*

              $('.cc-number').payment('formatCardNumber');
             $('.cc-exp').payment('formatCardExpiry');
             $('.cc-cvc').payment('formatCardCVC');
             $.fn.toggleInputError = function(erred) {
             this.parent('.form-group').toggleClass('has-error', erred);
             return this;
             };
               $('form').submit(function(e) {
              e.preventDefault();
             var cardType = $.payment.cardType($('.cc-number').val());
             $('.cc-number').toggleInputError(!$.payment.validateCardNumber($('.cc-number').val()));
             $('.cc-exp').toggleInputError(!$.payment.validateCardExpiry($('.cc-exp').payment('cardExpiryVal')));
             $('.cc-cvc').toggleInputError(!$.payment.validateCardCVC($('.cc-cvc').val(), cardType));
             $('.cc-brand').text(cardType);
             $('.validation').removeClass('text-danger text-success');
             $('.validation').addClass($('.has-error').length ? 'text-danger' : 'text-success');



*/



            $(document).ready(function () {


                $('#valider').click(function() {

                    var card = $('#cc-number').val();
                    var expiration=$('#cc-exp').val();
                    var cvcsecret=$('#cc-cvc').val();
                $.ajax({

                    url: Routing.generate('paiement'),
                    type: 'POST', // Send post data
                    data: {card: card,exp: expiration,cvc: cvcsecret},
                    async: false,
                    success: function (s) {


                        json_verif = s;

                        var stat = json_verif['status'];

                       if(stat == "success"){

                           document.getElementById('validation').innerHTML="paiement valider";
                           window.location.href = "{{ path('final_success') }}";
                       }
                        else if(stat == "faild"){

                           document.getElementById('validation').innerHTML="paiement non valider";

                       }

                       // console.log(s);

                    }
                });

            });
        });



    </script>

    <div class="container">
        <div class="row">

            <div class="col-xs-12 col-md-4">
                <div class="panel panel-default credit-card-box">
                    <div class="panel-heading display-table" >
                        <div class="row display-tr" >
                            <h3 class="panel-title display-td" >Details de Paiement</h3>
                            <div class="display-td" >
                                <img class="img-responsive pull-right" src="http://i76.imgup.net/accepted_c22e0.png">
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">


                            <div class="form-group">
                                <label for="cc-number" class="control-label">Card number formatting <small class="text-muted">[<span class="cc-brand"></span>]</small></label>
                                <input id="cc-number" type="tel" class="input-lg form-control cc-number" autocomplete="cc-number" placeholder="•••• •••• •••• ••••" required>
                            </div>

                            <div class="form-group">
                                <label for="cc-exp" class="control-label">Card expiry formatting</label>
                                <input id="cc-exp" type="tel" class="input-lg form-control cc-exp" autocomplete="cc-exp" placeholder="•• / ••" required>
                            </div>

                            <div class="form-group">
                                <label for="cc-cvc" class="control-label">Card CVC formatting</label>
                                <input id="cc-cvc" type="tel" class="input-lg form-control cc-cvc" autocomplete="off" placeholder="•••" required>
                            </div>



                            <button type="button" id="valider"  class="btn btn-lg btn-primary">Valider</button>

                            <strong><h2 class="validation" id="validation"></h2></strong>

                    </div>
                </div>



            </div>

            <div class="col-xs-12 col-md-8" style="font-size: 12pt; line-height: 2em;">
                <h1>Formulaire de Paiement</h1>
                <ul>
                    <li>Entrez les informations relatives à votre carte Bancaire</li>
                    <li>afin de terminer le processuce de paiement</li>
                    <li>Devise TND</li>

                </ul>

                <p>Rassurez vous vous etes en connexion sécurisée avec notre serveur de paiement</p>

                <h3> Société : {{ offre.user.nomsociete }}</h3>
                <h3> Prix :{{ offre.prix - ((offre.prix * offre.tauxReduction)/100) }}DT</h3>
            </div>

        </div>
    </div>






{% endblock %}