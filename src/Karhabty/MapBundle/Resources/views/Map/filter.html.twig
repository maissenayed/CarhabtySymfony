{% extends ':layout:LayoutUser.html.twig' %}

{% block content%}


	<div class="col-md-6">

		<div class="portlet-body">
			<div id="gmap_basic" class="gmaps">
			</div>

			<div class="portlet-body">
				<div id="gmap_basic" class="gmaps">
				</div>
			</div>
		</div>

		<div class="col-md-6">
			<form>
				<div class="col-md-5    ">

					<input type="button" class="btn green" value="Localiser" onclick="calcRoute();"/>
				</div>
			</form>
		</div>


		<script type="text/javascript">
            var map;
            var latlng;
            var myResult;
            var marker;

            function initMap() {
                var directionsService = new google.maps.DirectionsService;
                var directionsDisplay = new google.maps.DirectionsRenderer;
                var map = new google.maps.Map(document.getElementById('gmap_basic'), {
                    zoom: 7,
                    center: {lat: 36.84446074079564, lng: 10.111777782440186}
                });

                var markerPostion = new google.maps.Marker({
                    map: map,
                    title: 'Hello World!'
                });

                directionsDisplay.setMap(map);


                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        var pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };

                        markerPostion.setPosition(pos);
                        markerPostion.setMap(map);


                   //     var x= new google.maps.LatLng(36.83896555078597,10.20104169845581);

                     /*   var marker = new google.maps.Marker({
                            position: x,
                            map: map,
                            title: 'Hello World!'
                        });
*/
                          {%  for off in offres %}

						 var h ="{{ off.user.adresse }}";
						 var geocoder = new google.maps.Geocoder();
						 geocoder.geocode({address:h }, function(results, status) {
						 if (status == google.maps.GeocoderStatus.OK) {

						 var myResult = results[0].geometry.location; // reference LatLng value

						 //createMarker(myResult); // call the function that adds the marker

						 marker = new google.maps.Marker({
						 map: map,
						 position: myResult
						 });
						 map.setCenter(myResult);
                             marker.setMap(map);
						 // map.setZoom(17);

                             marker.addListener('click', function() {

                                 calculateAndDisplayRoute(directionsService, directionsDisplay,myResult,pos);

                             });

						 }
						 });




                        {% endfor %}

                   //     searchAddress();



                    }, function() {
                        handleLocationError(true, infoWindow, map.getCenter());
                    });
                } else {
                    // Browser doesn't support Geolocation
                    handleLocationError(false, infoWindow, map.getCenter());
                }






            }



            //handle location error

            function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                infoWindow.setPosition(pos);
                infoWindow.setContent(browserHasGeolocation ?
                    'Error: The Geolocation service failed.' :
                    'Error: Your browser doesn\'t support geolocation.');


            }





            //calcule de la route

            function calculateAndDisplayRoute(directionsService, directionsDisplay,o, e) {
                directionsService.route({
                    origin: o,
                    destination:e,
                    travelMode: google.maps.TravelMode.DRIVING
                }, function(response, status) {
                    if (status === google.maps.DirectionsStatus.OK) {
                        directionsDisplay.setDirections(response);
                    } else {
                        window.alert('Directions request failed due to ' + status);
                    }
                });
            }


		</script>
		<script async defer
				src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAe4BNAZTQY-9JxbRhpgFUNuxjuyeGOZtU&callback=initMap">
		</script>






{% endblock %}